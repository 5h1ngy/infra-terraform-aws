# CIDR e Subnet: Una Guida Dettagliata

## **Cosa Sono i CIDR?**

### **CIDR (Classless Inter-Domain Routing)**
Il CIDR è un metodo per rappresentare un intervallo di indirizzi IP in modo compatto e flessibile. È stato introdotto per sostituire il vecchio sistema di classi IP e migliorare l'allocazione degli indirizzi IP.

### **Struttura di un CIDR**
Un CIDR è composto da due parti:
1. **Indirizzo IP di base:** Specifica l'inizio dell'intervallo di indirizzi (esempio: `10.0.0.0`).
2. **Maschera di rete (prefisso):** Indica quanti bit dell'indirizzo sono riservati alla parte di rete (esempio: `/24`).

Esempio:
```plaintext
10.0.0.0/24
```
- **10.0.0.0**: Indirizzo IP di base.
- **/24**: I primi 24 bit sono riservati per la parte di rete.

### **Calcolo degli Indirizzi Disponibili**
La dimensione del prefisso (`/x`) determina quanti indirizzi IP sono disponibili:
- La formula è: `2^(32 - x)`
- **Esempi:**
  - `/24`: 256 indirizzi (2^(32-24))
  - `/28`: 16 indirizzi (2^(32-28))

**Nota:** AWS riserva 5 indirizzi per ogni Subnet:
- 1 per l'indirizzo di rete.
- 1 per il broadcast.
- 3 per usi interni (esempio: gateway).

Quindi, una Subnet con `/28` (16 indirizzi) ha solo **11 indirizzi utilizzabili**.

### **Esempi Pratici di CIDR**
| CIDR       | Numero Totale di Indirizzi | Indirizzi Utilizzabili (AWS) |
|------------|----------------------------|------------------------------|
| `10.0.0.0/16` | 65.536                    | 65.531                       |
| `10.0.0.0/24` | 256                       | 251                          |
| `10.0.0.0/28` | 16                        | 11                           |

---

## **Cosa Sono le Subnet?**

### **Subnet (Subnetwork)**
Una Subnet è una divisione logica di una rete più grande (definita da un CIDR). È utile per organizzare, isolare e ottimizzare l'uso degli indirizzi IP in una rete.

### **A Cosa Servono le Subnet?**
1. **Isolamento Logico:**
   - Separa le risorse in diverse zone di rete per migliorare la sicurezza e l'organizzazione.
   - Esempio: Subnet pubbliche per server accessibili da Internet, Subnet private per database.

2. **Efficienza:**
   - Ottimizza l'allocazione degli indirizzi IP evitando sprechi.

3. **Sicurezza:**
   - Permette di applicare regole di sicurezza differenti per ogni Subnet (ad esempio, gruppi di sicurezza e ACL).

### **Subnetting: Come Funziona**
Il subnetting consiste nel dividere un blocco CIDR in sotto-intervalli (Subnet). Ogni Subnet eredita una parte del CIDR principale.

#### **Esempio di Subnetting**
Rete principale: `10.0.0.0/24` (256 indirizzi).
- Subnet1: `10.0.0.0/26` (64 indirizzi).
- Subnet2: `10.0.0.64/26` (64 indirizzi).
- Subnet3: `10.0.0.128/26` (64 indirizzi).
- Subnet4: `10.0.0.192/26` (64 indirizzi).

**Nota:** Le Subnet devono essere uguali o più piccole della rete principale.

### **Subnet Pubbliche e Private**
In AWS, le Subnet possono essere configurate come pubbliche o private:

- **Subnet Pubblica:** Ha accesso a Internet tramite un Internet Gateway.
- **Subnet Privata:** Non ha accesso diretto a Internet. Le risorse interne possono comunicare solo tramite VPN o NAT Gateway.

| Tipo di Subnet  | Accesso Internet        | Esempio di Risorse           |
|------------------|-------------------------|------------------------------|
| Subnet Pubblica  | Accessibile da Internet | Server web, Load Balancer    |
| Subnet Privata   | Non accessibile         | Database, Backend Services   |

---

## **CIDR e Subnet in AWS**

### **Configurazione Pratica**
1. **VPC con CIDR:** Definisce l'intervallo di indirizzi IP per l'intera rete.
2. **Subnet all'interno della VPC:** Divide l'intervallo in blocchi più piccoli.

#### **Esempio di Configurazione**
```hcl
resource "aws_vpc" "example" {
  cidr_block           = "10.0.0.0/24" # Rete principale
  enable_dns_support   = true
  enable_dns_hostnames = true
  tags = {
    Name = "example-vpc"
  }
}

resource "aws_subnet" "public" {
  vpc_id                  = aws_vpc.example.id
  cidr_block              = "10.0.0.0/26" # Subnet pubblica
  map_public_ip_on_launch = true
  tags = {
    Name = "public-subnet"
  }
}

resource "aws_subnet" "private" {
  vpc_id                  = aws_vpc.example.id
  cidr_block              = "10.0.0.64/26" # Subnet privata
  map_public_ip_on_launch = false
  tags = {
    Name = "private-subnet"
  }
}
```

---

## **Come Calcolare Subnet e CIDR**

### **Calcolo degli Indirizzi Disponibili**
- Usa la formula `2^(32 - x)` per calcolare il numero totale di indirizzi.
- Ricorda di sottrarre i 5 indirizzi riservati da AWS.

Esempio:
- CIDR `/28` → `2^(32 - 28) = 16` (11 utilizzabili).
- CIDR `/24` → `2^(32 - 24) = 256` (251 utilizzabili).

### **Strumenti per il Calcolo**
Puoi utilizzare strumenti come:
- [CIDR Calculator](https://www.ipaddressguide.com/cidr).
- `subnetcalc` (CLI).

---

## **Conclusione**

1. **CIDR:** Definisce un intervallo di indirizzi IP.
2. **Subnet:** Suddivide un CIDR in blocchi più piccoli per scopi di organizzazione, isolamento e sicurezza.
3. **AWS:** Utilizza CIDR per configurare VPC e Subnet, ottimizzando l'allocazione degli indirizzi IP.
